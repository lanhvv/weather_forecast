const LicenseManagerImp = {
    licenseKey: undefined,
    passKey: undefined,
    debug: false,
    valid: false,
    verified: false,
    verify: function (licenseKey, passKey, debug = false) {
        [LicenseManagerImp.licenseKey, LicenseManagerImp.passKey, LicenseManagerImp.debug] = [licenseKey, passKey, debug];
        LicenseManagerImp.valid = LicenseManagerImp.verified = false;
    },
    check: async function () {
        if (!LicenseManagerImp.verified) {
            const isClient = !!(typeof window !== 'undefined' && window.document && window.document.createElement);
            LicenseManagerImp.verified = isClient;
            let debug = LicenseManagerImp.debug;
            let valid = false;
            try {
                const plaintext = await LicenseManagerImp.aesGcmDecrypt(LicenseManagerImp.licenseKey, LicenseManagerImp.passKey);
                const tokens = plaintext.split('_');
                const licenseDate = new Date(parseInt(tokens[2]));
                if (tokens.length !== 8) {
                    if (debug)
                        console.log('Error code: 1333');
                    valid = false;
                }
                else if (tokens[0].length !== 2) {
                    if (debug)
                        console.log('Error code: 1334');
                    valid = false;
                }
                else if (isNaN(parseInt(tokens[1]))) {
                    if (debug)
                        console.log('Error code: 1335');
                    valid = false;
                }
                else if (tokens[3] !== 'PRIMENG') {
                    if (debug)
                        console.log('Error code: 1336');
                    valid = false;
                }
                else if (tokens[5] === 'BASIC' && licenseDate <= new Date()) {
                    if (debug)
                        console.log('Error code: 1337');
                    valid = false;
                }
                else if (tokens[6] !== '16') {
                    if (debug)
                        console.log('Error code: 1338');
                    valid = false;
                }
                else if (tokens[7].length !== 6) {
                    if (debug)
                        console.log('Error code: 1339');
                    valid = false;
                }
                else {
                    valid = true;
                }
            }
            catch (e) {
                if (debug)
                    console.log('Error:', e.message);
                valid = false;
            }
            if (!valid && isClient) {
                const link = document.createElement('a');
                link.setAttribute('href', 'https://primeng.org/lts');
                link.setAttribute('style', 'background-color: red !important; color: white !important; cursor: pointer !important; font-size: 14px !important; font-weight: bold !important; position: fixed !important; z-index: 9999999999 !important; top: 0 !important; left: 0 !important; display: inline !important; width: 100% !important; padding: 1rem !important; opacity: 1 !important; pointer-events: auto !important; visibility: visible !important;');
                const msg = document.createElement('marquee');
                msg.setAttribute('behavior', 'alternate');
                msg.innerText = 'You are using an LTS version of PrimeNG with an invalid license, you may either switch back to a non-LTS version or purchase a license at PrimeStore.';
                link.appendChild(msg);
                document.body.appendChild(link);
                let linkObserver, documentObserver;
                const observerCallback = () => {
                    linkObserver.disconnect();
                    documentObserver.disconnect();
                    link && link.remove();
                    LicenseManagerImp.verified = false;
                    LicenseManagerImp.check();
                };
                linkObserver = new MutationObserver(() => observerCallback());
                linkObserver.observe(link, { attributes: true, childList: true });
                documentObserver = new MutationObserver((_) => _.forEach((mutation) => mutation.removedNodes.length > 0 && mutation.removedNodes.forEach((item) => item.isSameNode(link) && observerCallback())));
                documentObserver.observe(document.body, { childList: true });
            }
            LicenseManagerImp.valid = valid;
        }
        return LicenseManagerImp.valid;
    },
    aesGcmDecrypt: async function (ciphertext, password) {
        const pwUtf8 = new TextEncoder().encode(password);
        const pwHash = await crypto.subtle.digest('SHA-256', pwUtf8);
        const ivStr = atob(ciphertext).slice(0, 12);
        const iv = new Uint8Array(Array.from(ivStr).map((ch) => ch.charCodeAt(0)));
        const alg = { name: 'AES-GCM', iv: iv };
        const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']);
        const ctStr = atob(ciphertext).slice(12);
        const ctUint8 = new Uint8Array(Array.from(ctStr).map((ch) => ch.charCodeAt(0)));
        try {
            const plainBuffer = await crypto.subtle.decrypt(alg, key, ctUint8);
            const plaintext = new TextDecoder().decode(plainBuffer);
            return plaintext;
        }
        catch (e) {
            throw new Error('Decrypt failed');
        }
    }
};
export const LicenseManager = Object.freeze({
    verify: LicenseManagerImp.verify,
    check: LicenseManagerImp.check
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGljZW5zZW1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYXBwL2NvbXBvbmVudHMvYXBpL2xpY2Vuc2VtYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0saUJBQWlCLEdBQUc7SUFDdEIsVUFBVSxFQUFFLFNBQVM7SUFDckIsT0FBTyxFQUFFLFNBQVM7SUFDbEIsS0FBSyxFQUFFLEtBQUs7SUFDWixLQUFLLEVBQUUsS0FBSztJQUNaLFFBQVEsRUFBRSxLQUFLO0lBQ2YsTUFBTSxFQUFFLFVBQVUsVUFBa0IsRUFBRSxPQUFlLEVBQUUsUUFBaUIsS0FBSztRQUN6RSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsaUJBQWlCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2xILGlCQUFpQixDQUFDLEtBQUssR0FBRyxpQkFBaUIsQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQ2pFLENBQUM7SUFDRCxLQUFLLEVBQUUsS0FBSztRQUNSLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUU7WUFDN0IsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE1BQU0sQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN2RyxpQkFBaUIsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1lBRXRDLElBQUksS0FBSyxHQUFHLGlCQUFpQixDQUFDLEtBQUssQ0FBQztZQUNwQyxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUM7WUFDbEIsSUFBSTtnQkFDQSxNQUFNLFNBQVMsR0FBRyxNQUFNLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsaUJBQWlCLENBQUMsT0FBTyxDQUFD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V0FBVyxVQUFrQixFQUFFLFFBQWdCO1FBQy9ELE1BQU0sTUFBTSxHQUFHLElBQUksV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sTUFBTSxHQUFHLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTdELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLE1BQU0sRUFBRSxHQUFHLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUzRSxNQUFNLEdBQUcsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBRXhDLE1BQU0sR0FBRyxHQUFHLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUVsRixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sT0FBTyxHQUFHLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoRixJQUFJO1lBQ0EsTUFBTSxXQUFXLEdBQUcsTUFBTSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ25FLE1BQU0sU0FBUyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3hELE9BQU8sU0FBUyxDQUFDO1NBQ3BCO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDUixNQUFNLElBQUksS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7U0FDckM7SUFDTCxDQUFDO0NBQ0osQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ3hDLE1BQU0sRUFBRSxpQkFBaUIsQ0FBQyxNQUFNO0lBQ2hDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxLQUFLO0NBQ2pDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IExpY2Vuc2VNYW5hZ2VySW1wID0ge1xuICAgIGxpY2Vuc2VLZXk6IHVuZGVmaW5lZCxcbiAgICBwYXNzS2V5OiB1bmRlZmluZWQsXG4gICAgZGVidWc6IGZhbHNlLFxuICAgIHZhbGlkOiBmYWxzZSxcbiAgICB2ZXJpZmllZDogZmFsc2UsXG4gICAgdmVyaWZ5OiBmdW5jdGlvbiAobGljZW5zZUtleTogc3RyaW5nLCBwYXNzS2V5OiBzdHJpbmcsIGRlYnVnOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICAgICAgW0xpY2Vuc2VNYW5hZ2VySW1wLmxpY2Vuc2VLZXksIExpY2Vuc2VNYW5hZ2VySW1wLnBhc3NLZXksIExpY2Vuc2VNYW5hZ2VySW1wLmRlYnVnXSA9IFtsaWNlbnNlS2V5LCBwYXNzS2V5LCBkZWJ1Z107XG4gICAgICAgIExpY2Vuc2VNYW5hZ2VySW1wLnZhbGlkID0gTGljZW5zZU1hbmFnZXJJbXAudmVyaWZpZWQgPSBmYWxzZTtcbiAgICB9LFxuICAgIGNoZWNrOiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghTGljZW5zZU1hbmFnZXJJbXAudmVyaWZpZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGlzQ2xpZW50ID0gISEodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmRvY3VtZW50ICYmIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KTtcbiAgICAgICAgICAgIExpY2Vuc2VNYW5hZ2VySW1wLnZlcmlmaWVkID0gaXNDbGllbnQ7XG5cbiAgICAgICAgICAgIGxldCBkZWJ1ZyA9IExpY2Vuc2VNYW5hZ2VySW1wLmRlYnVnO1xuICAgICAgICAgICAgbGV0IHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBsYWludGV4dCA9IGF3YWl0IExpY2Vuc2VNYW5hZ2VySW1wLmFlc0djbURlY3J5cHQoTGljZW5zZU1hbmFnZXJJbXAubGljZW5zZUtleSwgTGljZW5zZU1hbmFnZXJJbXAucGFzc0tleSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW5zID0gcGxhaW50ZXh0LnNwbGl0KCdfJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGljZW5zZURhdGUgPSBuZXcgRGF0ZShwYXJzZUludCh0b2tlbnNbMl0pKTtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCAhPT0gOCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVidWcpIGNvbnNvbGUubG9nKCdFcnJvciBjb2RlOiAxMzMzJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRva2Vuc1swXS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlYnVnKSBjb25zb2xlLmxvZygnRXJyb3IgY29kZTogMTMzNCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc05hTihwYXJzZUludCh0b2tlbnNbMV0pKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVidWcpIGNvbnNvbGUubG9nKCdFcnJvciBjb2RlOiAxMzM1Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRva2Vuc1szXSAhPT0gJ1BSSU1FTkcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWJ1ZykgY29uc29sZS5sb2coJ0Vycm9yIGNvZGU6IDEzMzYnKTtcblxuICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG9rZW5zWzVdID09PSAnQkFTSUMnICYmIGxpY2Vuc2VEYXRlIDw9IG5ldyBEYXRlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlYnVnKSBjb25zb2xlLmxvZygnRXJyb3IgY29kZTogMTMzNycpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b2tlbnNbNl0gIT09ICcxNicpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlYnVnKSBjb25zb2xlLmxvZygnRXJyb3IgY29kZTogMTMzOCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b2tlbnNbN10ubGVuZ3RoICE9PSA2KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWJ1ZykgY29uc29sZS5sb2coJ0Vycm9yIGNvZGU6IDEzMzknKTtcblxuICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRlYnVnKSBjb25zb2xlLmxvZygnRXJyb3I6JywgZS5tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdmFsaWQgJiYgaXNDbGllbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgJ2h0dHBzOi8vcHJpbWVuZy5vcmcvbHRzJyk7XG4gICAgICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgICAgICAgICAgICdzdHlsZScsXG4gICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yOiByZWQgIWltcG9ydGFudDsgY29sb3I6IHdoaXRlICFpbXBvcnRhbnQ7IGN1cnNvcjogcG9pbnRlciAhaW1wb3J0YW50OyBmb250LXNpemU6IDE0cHggIWltcG9ydGFudDsgZm9udC13ZWlnaHQ6IGJvbGQgIWltcG9ydGFudDsgcG9zaXRpb246IGZpeGVkICFpbXBvcnRhbnQ7IHotaW5kZXg6IDk5OTk5OTk5OTkgIWltcG9ydGFudDsgdG9wOiAwICFpbXBvcnRhbnQ7IGxlZnQ6IDAgIWltcG9ydGFudDsgZGlzcGxheTogaW5saW5lICFpbXBvcnRhbnQ7IHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7IHBhZGRpbmc6IDFyZW0gIWltcG9ydGFudDsgb3BhY2l0eTogMSAhaW1wb3J0YW50OyBwb2ludGVyLWV2ZW50czogYXV0byAhaW1wb3J0YW50OyB2aXNpYmlsaXR5OiB2aXNpYmxlICFpbXBvcnRhbnQ7J1xuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtYXJxdWVlJyk7XG4gICAgICAgICAgICAgICAgbXNnLnNldEF0dHJpYnV0ZSgnYmVoYXZpb3InLCAnYWx0ZXJuYXRlJyk7XG4gICAgICAgICAgICAgICAgbXNnLmlubmVyVGV4dCA9ICdZb3UgYXJlIHVzaW5nIGFuIExUUyB2ZXJzaW9uIG9mIFByaW1lTkcgd2l0aCBhbiBpbnZhbGlkIGxpY2Vuc2UsIHlvdSBtYXkgZWl0aGVyIHN3aXRjaCBiYWNrIHRvIGEgbm9uLUxUUyB2ZXJzaW9uIG9yIHB1cmNoYXNlIGEgbGljZW5zZSBhdCBQcmltZVN0b3JlLic7XG5cbiAgICAgICAgICAgICAgICBsaW5rLmFwcGVuZENoaWxkKG1zZyk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTtcblxuICAgICAgICAgICAgICAgIGxldCBsaW5rT2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXIsIGRvY3VtZW50T2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXI7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JzZXJ2ZXJDYWxsYmFjayA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGlua09ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGxpbmsgJiYgbGluay5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgTGljZW5zZU1hbmFnZXJJbXAudmVyaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgTGljZW5zZU1hbmFnZXJJbXAuY2hlY2soKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgbGlua09ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4gb2JzZXJ2ZXJDYWxsYmFjaygpKTtcbiAgICAgICAgICAgICAgICBsaW5rT2JzZXJ2ZXIub2JzZXJ2ZShsaW5rLCB7IGF0dHJpYnV0ZXM6IHRydWUsIGNoaWxkTGlzdDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgIGRvY3VtZW50T2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoXykgPT4gXy5mb3JFYWNoKChtdXRhdGlvbikgPT4gbXV0YXRpb24ucmVtb3ZlZE5vZGVzLmxlbmd0aCA+IDAgJiYgbXV0YXRpb24ucmVtb3ZlZE5vZGVzLmZvckVhY2goKGl0ZW0pID0+IGl0ZW0uaXNTYW1lTm9kZShsaW5rKSAmJiBvYnNlcnZlckNhbGxiYWNrKCkpKSk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRPYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBMaWNlbnNlTWFuYWdlckltcC52YWxpZCA9IHZhbGlkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIExpY2Vuc2VNYW5hZ2VySW1wLnZhbGlkO1xuICAgIH0sXG4gICAgYWVzR2NtRGVjcnlwdDogYXN5bmMgZnVuY3Rpb24gKGNpcGhlcnRleHQ6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZykge1xuICAgICAgICBjb25zdCBwd1V0ZjggPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUocGFzc3dvcmQpO1xuICAgICAgICBjb25zdCBwd0hhc2ggPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRpZ2VzdCgnU0hBLTI1NicsIHB3VXRmOCk7XG5cbiAgICAgICAgY29uc3QgaXZTdHIgPSBhdG9iKGNpcGhlcnRleHQpLnNsaWNlKDAsIDEyKTtcbiAgICAgICAgY29uc3QgaXYgPSBuZXcgVWludDhBcnJheShBcnJheS5mcm9tKGl2U3RyKS5tYXAoKGNoKSA9PiBjaC5jaGFyQ29kZUF0KDApKSk7XG5cbiAgICAgICAgY29uc3QgYWxnID0geyBuYW1lOiAnQUVTLUdDTScsIGl2OiBpdiB9O1xuXG4gICAgICAgIGNvbnN0IGtleSA9IGF3YWl0IGNyeXB0by5zdWJ0bGUuaW1wb3J0S2V5KCdyYXcnLCBwd0hhc2gsIGFsZywgZmFsc2UsIFsnZGVjcnlwdCddKTtcblxuICAgICAgICBjb25zdCBjdFN0ciA9IGF0b2IoY2lwaGVydGV4dCkuc2xpY2UoMTIpO1xuICAgICAgICBjb25zdCBjdFVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkoQXJyYXkuZnJvbShjdFN0cikubWFwKChjaCkgPT4gY2guY2hhckNvZGVBdCgwKSkpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwbGFpbkJ1ZmZlciA9IGF3YWl0IGNyeXB0by5zdWJ0bGUuZGVjcnlwdChhbGcsIGtleSwgY3RVaW50OCk7XG4gICAgICAgICAgICBjb25zdCBwbGFpbnRleHQgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUocGxhaW5CdWZmZXIpO1xuICAgICAgICAgICAgcmV0dXJuIHBsYWludGV4dDtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEZWNyeXB0IGZhaWxlZCcpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IExpY2Vuc2VNYW5hZ2VyID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgdmVyaWZ5OiBMaWNlbnNlTWFuYWdlckltcC52ZXJpZnksXG4gICAgY2hlY2s6IExpY2Vuc2VNYW5hZ2VySW1wLmNoZWNrXG59KTtcbiJdfQ==